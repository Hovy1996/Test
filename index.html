<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Volný pád (auto start)</title>
<style>
  body{margin:0;background:#0d1326;color:#eaf0ff;font-family:system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:980px;margin:18px auto;padding:0 16px}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
  label{font-size:14px;color:#9fb0ff}
  input,select{background:#111a3b;color:#eaf0ff;border:1px solid #263370;border-radius:8px;padding:6px 8px}
  canvas{display:block;width:100%;max-width:980px;height:auto;background:#081026;border:1px solid #1d2a55;border-radius:12px}
  .small{font-size:12px;color:#9fb0ff}
  button{background:#18245a;color:#eaf0ff;border:1px solid #2a3a84;border-radius:10px;padding:8px 12px;cursor:pointer}
</style>
</head>
<body>
<div class="wrap">
  <h1>Volný pád s odporem vzduchu</h1>
  <p class="small">Model: <code>m·dv/dt = m·g − ½·ρ·C<sub>d</sub>·A·v|v|</code>. Spustí se automaticky.</p>

  <div class="row">
    <label>Tvar:
      <select id="shape">
        <option value="sphere" selected>Koule (Cd≈0.47)</option>
        <option value="cube">Krychle (Cd≈1.05)</option>
        <option value="disk">Disk čelem (Cd≈1.17)</option>
        <option value="teardrop">Proudnicové (Cd≈0.05)</option>
      </select>
    </label>
    <label>Rozměr (cm):
      <input id="size" type="number" value="20" min="2" max="100" step="1">
    </label>
    <label>Hmotnost m (kg):
      <input id="m" type="number" value="1.0" min="0.05" max="50" step="0.05">
    </label>
    <label>Výška h₀ (m):
      <input id="h0" type="number" value="80" min="5" max="200" step="1">
    </label>
    <button id="reset">Reset</button>
    <button id="pause">Pauza</button>
  </div>

  <p class="small">Terminální rychlost: <span id="vt">–</span> m/s &nbsp;|&nbsp; A: <span id="A">–</span> m² &nbsp;|&nbsp; C<sub>d</sub>: <span id="Cd">–</span></p>

  <canvas id="c" width="960" height="420"></canvas>
</div>

<script>
const $ = id => document.getElementById(id);
const c = $('c'), ctx = c.getContext('2d');

const ui = {shape:$('shape'), size:$('size'), m:$('m'), h0:$('h0'), vt:$('vt'), A:$('A'), Cd:$('Cd'),
            reset:$('reset'), pause:$('pause')};

const SHAPES = {
  sphere:   { cd:0.47, area:(d)=>Math.PI*(d**2)/4, label:"Průměr" },
  cube:     { cd:1.05, area:(a)=>a**2,              label:"Strana" },
  disk:     { cd:1.17, area:(d)=>Math.PI*(d**2)/4, label:"Průměr" },
  teardrop: { cd:0.05, area:(d)=>Math.PI*(d**2)/4, label:"Průměr" }
};

let state = {
  m: 1, rho: 1.225, g: 9.81,
  A: 0.0314, Cd: 0.47,
  y: 0, v: 0, t: 0, h0: 80,
  running: true
};

const pxPerM = 4;
const groundY = c.height - 28;

function recalc(){
  // přepočet A a Cd ze vstupů
  const sKey = ui.shape.value;
  const S = SHAPES[sKey];
  const size_m = parseFloat(ui.size.value)/100; // cm → m
  state.A = S.area(size_m);
  state.Cd = S.cd;
  state.m = parseFloat(ui.m.value);
  state.h0 = parseFloat(ui.h0.value);
  // terminální rychlost
  const denom = state.rho*state.Cd*state.A;
  state.vt = denom>0 ? Math.sqrt((2*state.m*state.g)/denom) : Infinity;
  ui.vt.textContent = isFinite(state.vt)? state.vt.toFixed(2) : '∞';
  ui.A.textContent = state.A.toFixed(4);
  ui.Cd.textContent = state.Cd.toFixed(2);
}

function reset(){
  recalc();
  state.y = 0; state.v = 0; state.t = 0;
  state.running = true;
}
ui.reset.onclick = reset;
ui.pause.onclick = ()=>{ state.running = !state.running; ui.pause.textContent = state.running ? 'Pauza' : 'Pokračovat'; };
['change','input'].forEach(ev=>{
  ui.shape.addEventListener(ev, recalc);
  ui.size.addEventListener(ev, recalc);
  ui.m.addEventListener(ev, recalc);
  ui.h0.addEventListener(ev, recalc);
});

function accel(v){
  const drag = 0.5*state.rho*state.Cd*state.A*v*Math.abs(v);
  return state.g - drag/state.m; // směr + dolů
}

let last = performance.now();
function loop(now){
  const dt = Math.min((now-last)/1000, 0.05); // bezpečný krok
  last = now;

  if(state.running && state.y < state.h0){
    // RK4 integrace
    let v1=state.v, a1=accel(v1);
    let v2=state.v + 0.5*a1*dt, a2=accel(v2);
    let v3=state.v + 0.5*a2*dt, a3=accel(v3);
    let v4=state.v + a3*dt,     a4=accel(v4);

    const dv = (a1 + 2*a2 + 2*a3 + a4)/6 * dt;
    const vMid = state.v + 0.5*dv;
    state.v += dv;
    state.y += vMid*dt;
    state.t += dt;

    if(state.y >= state.h0){ state.y = state.h0; state.v = 0; }
  }

  draw();
  requestAnimationFrame(loop);
}

function draw(){
  ctx.clearRect(0,0,c.width,c.height);
  // pozadí
  const g = ctx.createLinearGradient(0,0,0,c.height);
  g.addColorStop(0,'#0a132e'); g.addColorStop(1,'#060b1d'); ctx.fillStyle=g; ctx.fillRect(0,0,c.width,c.height);

  // zem
  ctx.strokeStyle='#5ee1a5'; ctx.lineWidth=2;
  ctx.beginPath(); ctx.moveTo(0,groundY); ctx.lineTo(c.width,groundY); ctx.stroke();

  // výškové čáry
  ctx.strokeStyle='rgba(255,255,255,.1)';
  for(let m=0;m<=state.h0;m+=10){
    const y = groundY - m*pxPerM;
    ctx.beginPath(); ctx.moveTo(20,y); ctx.lineTo(c.width-20,y); ctx.stroke();
  }

  // objekt – uprostřed nahoře, padá dolů
  const x = c.width/2;
  const y = groundY - state.y*pxPerM;
  ctx.fillStyle='#cfe9ff'; ctx.strokeStyle='#7fbfff'; ctx.lineWidth=2;

  const key = ui.shape.value;
  if(key==='cube'){
    ctx.beginPath(); ctx.rect(x-18,y-18,36,36); ctx.fill(); ctx.stroke();
  }else if(key==='disk'){
    ctx.beginPath(); ctx.arc(x,y,20,0,Math.PI*2); ctx.fill(); ctx.stroke();
  }else if(key==='teardrop'){
    ctx.beginPath();
    ctx.moveTo(x-18,y);
    ctx.quadraticCurveTo(x-10,y-14,x,y-22);
    ctx.quadraticCurveTo(x+10,y-14,x+18,y);
    ctx.quadraticCurveTo(x+10,y+14,x,y+22);
    ctx.quadraticCurveTo(x-10,y+14,x-18,y);
    ctx.closePath(); ctx.fill(); ctx.stroke();
  }else{ // sphere default
    ctx.beginPath(); ctx.arc(x,y,18,0,Math.PI*2); ctx.fill(); ctx.stroke();
  }

  // info
  ctx.fillStyle='#aecdff'; ctx.font='12px system-ui';
  ctx.fillText(`t = ${state.t.toFixed(2)} s`, 20, 22);
  ctx.fillText(`v = ${state.v.toFixed(2)} m/s`, 20, 38);
  ctx.fillText(`y = ${state.y.toFixed(2)} m`, 20, 54);
}

recalc(); reset();
requestAnimationFrame(loop);
</script>
</body>
</html>


